<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>vjson-lang interpreter</title>
    <link rel="stylesheet" href="style.css">
</head>
<body style="background-color: #5c5c5c">
<div id="root">
    <div id="editor" class="mono" style="line-height: 32px;"></div>
    <div id="tmpl">
        <div class="custom-select" style="width:200px;">
            <select>
                <option>Fibonacci</option>
                <option>HelloWorld</option>
                <option>Syntax</option>
                <option>BuiltInTypes</option>
            </select>
        </div>
    </div>
    <div id="console" class="mono" style="line-height: 24px;"></div>
    <div id="buttons">
        <button id="run-btn" style="width: 80px; margin-left: 1px;">Run</button>
        <button id="clear-btn" style="width: 120px">Clear Output</button>
    </div>
</div>
</body>
<script src="online_vjson_lang_interpreter.js"></script>
<script src="ace.min.js" type="text/javascript" charset="utf-8"></script>
<script src="mode-javascript.min.js" type="text/javascript" charset="utf-8"></script>
<script src="custom-select.js"></script>
<script>
    var PROG_HELLO = "{\n" +
        "std.console.log: [('Hello vjson-lang')]\n" +
        "}\n"
    var PROG_FIB = "{\n" +
        "function fib: { n: 'int' } int: {\n" +
        "    var cache = { new (int[n+1]) }\n" +
        "    function fib0: { a: 'int' } int: {\n" +
        "        if: (cache[a] == 0) then: {\n" +
        "            if: (a == 1) then: { cache[a] = 1 }\n" +
        "            else if: (a == 2) then: { cache[a] = 1 }\n" +
        "            else: { cache[a] = (fib0:[a-1] + fib0:[a-2]) }\n" +
        "        }\n" +
        "        return: (cache[a])\n" +
        "    }\n" +
        "    return: (fib0:[n])\n" +
        "}\n" +
        "var n = 10\n" +
        "std.console.log: [(n + 'th element of the Fibonacci sequence is ' + fib:[n])]\n" +
        "}\n"
    var PROG_SYNTAX = "{ // vjson-lang starts with `{`\n" +
        "// variable definition\n" +
        "var variableName = 1\n" +
        "\n" +
        "// function definition\n" +
        "function max:{a: 'int', b: 'int'} int: {\n" +
        "  // if statement\n" +
        "  if: (a > b) then: { return: (a) }\n" +
        "  else: { return: (b) }\n" +
        "}\n" +
        "\n" +
        "// function invocation\n" +
        "var result = (max:[1, 2])\n" +
        "\n" +
        "// number, bool literals can be directly used\n" +
        "var intVar = 1\n" +
        "var longVar = 1000000000 // exceeds Integer.MAX_VALUE\n" +
        "var doubleVar = 1.2\n" +
        "// use toFloat to convert other number types to float\n" +
        "var floatVar = doubleVar.toFloat\n" +
        "var boolVar = true\n" +
        "// strings should be inside (...)\n" +
        "var strVar = ('hello')\n" +
        "// other expressions should be inside (...)\n" +
        "var calc = (1 + 2 * 3 - 4)\n" +
        "// if you are not sure which expression can be used without parentheses\n" +
        "// simply add parentheses around it, it will always work in this way\n" +
        "\n" +
        "// to define a variable with null, you must specify the type\n" +
        "var nullVariable = {null: 'string'}\n" +
        "nullVariable = ('abc') // assign a string to it\n" +
        "// assigning a variable with null does not require a type\n" +
        "nullVariable = null\n" +
        "\n" +
        "// class definition\n" +
        "class Person: {name: 'string', age: 'int'} do: {\n" +
        "  public var publicField = 1\n" +
        "  private var privateField = 2\n" +
        "  // variables directly inside class are considered private by default\n" +
        "  var alsoPrivateField = 3\n" +
        "  // functions directly inside class are considered public by default\n" +
        "  function talkTo: {person: 'Person'} void: {\n" +
        "    std.console.log:[( \"Hi \" + person.name + \", I\\'m \" + name )]\n" +
        "  }\n" +
        "  private function privateFunc: {} void: { }\n" +
        "}\n" +
        "// objects\n" +
        "var alice = {new Person:[('alice'), 24]}\n" +
        "var bob = {new Person:[('bob'), 25]}\n" +
        "alice.talkTo:[(bob)]\n" +
        "\n" +
        "// loops\n" +
        "// for loop\n" +
        "var sum = 0\n" +
        "for: [{ var i = 1 }, (i <= 10), (i += 1)] do: {\n" +
        "  sum = (sum + i)\n" +
        "}\n" +
        "std.console.log:[( 'sum of 1 to 10 is ' + sum )]\n" +
        "// while loop\n" +
        "sum = 0\n" +
        "var n = 1\n" +
        "while: (true) do: {\n" +
        "  sum = (sum + n)\n" +
        "  n = (n + 1)\n" +
        "  if: (n >= 10) then: {\n" +
        "    break\n" +
        "  }\n" +
        "}\n" +
        "std.console.log:[( 'sum of 1 until 10 is ' + sum )]\n" +
        "} // vjson-lang program ends with `}`\n"
    var PROG_BUILTIN = "{\n" +
        "var intVar = 1\n" +
        "var longVar = 10000000000\n" +
        "var doubleVar = 0.8\n" +
        "var floatVar = (0.8.toFloat)\n" +
        "var boolVar = true\n" +
        "var stringVar = ('hello')\n" +
        "var nullVar = {null: 'string'}\n" +
        "// assign string value to the nullVar\n" +
        "nullVar = ('null')\n" +
        "\n" +
        "// convert number types\n" +
        "// all number types can convert to each other\n" +
        "var toInt = (doubleVar.toInt)\n" +
        "var toLong = (intVar.toLong)\n" +
        "var toFloat = (intVar.toFloat)\n" +
        "var toDouble = (intVar.toDouble)\n" +
        "\n" +
        "// format to string\n" +
        "/* All built-in types (except string),\n" +
        " * has .toString:[] function.\n" +
        " */\n" +
        "var toString = (intVar.toString:[])\n" +
        "\n" +
        "/* If a type has .toString:[] function,\n" +
        " * you can use `+` to concat it to a string\n" +
        " */\n" +
        "var stringPlusInt = ('' + intVar)\n" +
        "var intPlusString = (intVar + '')\n" +
        "class MyType: {a: 'int', b: 'double'} do: {\n" +
        "  function toString:{} string: {\n" +
        "    return: ('MyType(a=' + a + ', b=' + b + ')')\n" +
        "  }\n" +
        "}\n" +
        "var myInstance = {new MyType:[1, 1.2]}\n" +
        "\n" +
        "// print them\n" +
        "std.console.log: [(\n" +
        "  'intVar = ' + intVar +\n" +
        "  '\\nlongVar = ' + longVar +\n" +
        "  '\\ndoubleVar = ' + doubleVar +\n" +
        "  '\\nfloatVar = ' + floatVar +\n" +
        "  '\\nboolVar = ' + boolVar +\n" +
        "  '\\nstringVar = ' + stringVar +\n" +
        "  '\\nnullVar = ' + nullVar +\n" +
        "  '\\ntoInt = ' + toInt +\n" +
        "  '\\ntoLong = ' + toLong +\n" +
        "  '\\ntoFloat = ' + toFloat +\n" +
        "  '\\ntoDouble = ' + toDouble +\n" +
        "  '\\ntoString = ' + toString +\n" +
        "  '\\nstringPlusInt = ' + stringPlusInt +\n" +
        "  '\\nintPlusString = ' + intPlusString +\n" +
        "  '\\nmyInstance = ' + myInstance\n" +
        ")]" +
        "}\n";
    var progs = {
        'Fibonacci': PROG_FIB,
        'HelloWorld': PROG_HELLO,
        'Syntax': PROG_SYNTAX,
        'BuiltInTypes': PROG_BUILTIN
    };

    var editor = ace.edit("editor");
    editor.setFontSize(16);
    editor.setTheme("ace/theme/one_dark");
    editor.setShowPrintMargin(false)
    var JavaScriptMode = ace.require("ace/mode/javascript").Mode;
    editor.session.setMode(new JavaScriptMode());
    editor.getSession().setValue(PROG_FIB);

    var aceConsole = ace.edit("console");
    aceConsole.setFontSize(16);
    aceConsole.setTheme("ace/theme/one_dark");
    aceConsole.setShowPrintMargin(false);
    aceConsole.setHighlightActiveLine(false);
    aceConsole.setOptions({
        showGutter: false,
        wrap: true,
    });
    aceConsole.setReadOnly(true);
    aceConsole.getSession().setValue("\n");

    online_vjson_lang_interpreter.registerOutput(function (line) {
        var newLines = aceConsole.getSession().getValue() + line + '\n';
        aceConsole.getSession().setValue(newLines);
    });
    online_vjson_lang_interpreter.registerCursorJump(function (line, col) {
        editor.gotoLine(line, col - 1, true);
        editor.focus();
    });

    document.getElementById("run-btn").addEventListener("click", function () {
        var code = editor.getSession().getValue();
        online_vjson_lang_interpreter.run(code);
    });
    document.getElementById("clear-btn").addEventListener("click", function () {
        aceConsole.getSession().setValue("\n");
    });
    applyCustomSelect(function (title) {
        var text = progs[title];
        if (text) {
            editor.getSession().setValue(text)
        }
    });
</script>
</html>
